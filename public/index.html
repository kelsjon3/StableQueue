<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobileSD Interface</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Socket.io client library -->
    <script src="/socket.io/socket.io.js"></script>
    <!-- MobileSD Job Status Client -->
    <script src="js/jobStatusClient.js"></script>
</head>
<body>
    <header>
        <h1>MobileSD</h1>
        <nav>
            <button id="nav-queue" class="nav-button active">Queue</button>
            <button id="nav-gallery" class="nav-button">Gallery</button>
            <button id="nav-server-setup" class="nav-button">Server Setup</button>
        </nav>
    </header>

    <main id="main-content">

        <section id="queue-view">
            <h2>Job Queue</h2>
            
            <div id="queue-controls" class="card">
                <button id="refresh-queue-btn" class="secondary-button">Refresh Queue</button>
                <div class="queue-filter">
                    <label for="queue-status-filter">Status:</label>
                    <select id="queue-status-filter">
                        <option value="">All Jobs</option>
                        <option value="pending">Pending</option>
                        <option value="processing">Processing</option>
                        <option value="completed">Completed</option>
                        <option value="failed">Failed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
            
            <div id="queue-container" class="card">
                <table id="queue-table">
                    <thead>
                        <tr>
                            <th>Job ID</th>
                            <th>Status</th>
                            <th>Server</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="queue-jobs">
                        <!-- Job rows will be inserted here dynamically -->
                    </tbody>
                </table>
                <div id="queue-loading">Loading jobs...</div>
                <div id="queue-empty" style="display: none;">No jobs found.</div>
            </div>
            
            <div id="job-details-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <div class="modal-body">
                        <h3>Job Details</h3>
                        <div id="job-details-content"></div>
                        <div id="job-actions">
                            <button id="cancel-job-btn" class="danger-button">Cancel Job</button>
                            <button id="delete-job-btn" class="danger-button">Delete Job</button>
                            <button id="view-job-results-btn" class="secondary-button">View Results</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="gallery-view" style="display: none;">
            <h2>Image Gallery</h2>
            
            <div id="gallery-controls" class="card">
                <button id="refresh-gallery-btn" class="secondary-button">Refresh Gallery</button>
                <div class="gallery-filter">
                    <label for="gallery-search">Search:</label>
                    <input type="text" id="gallery-search" placeholder="Filter by filename...">
                </div>
            </div>
            
            <div id="gallery-container" class="card">
                <div id="gallery-images"></div>
                <div id="gallery-loading">Loading images...</div>
                <div id="gallery-empty" style="display: none;">No images found.</div>
            </div>
            
            <div id="image-viewer-modal" class="modal" style="display: none;">
                <div class="modal-content">
                    <span class="close-modal">&times;</span>
                    <div class="modal-body">
                        <img id="modal-image" src="" alt="Full size image">
                        <div id="modal-image-info"></div>
                        <button id="delete-image-btn" class="danger-button">Delete Image</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="server-setup-view" style="display: none;">
            <h2>Server Configuration</h2>
             <div id="server-list-container" class="card">
                 <h3>Existing Servers</h3>
                 <ul id="server-list"></ul>
             </div>
             <div id="add-server-form-container" class="card">
                 <h3>Add/Edit Server</h3>
                 <form id="server-form">
                     <input type="hidden" id="edit-alias" value="">
                     <div class="form-group">
                         <label for="server-alias">Alias:</label>
                         <input type="text" id="server-alias" required>
                     </div>
                     <div class="form-group">
                         <label for="server-api-url">API URL (e.g., http://host:port):</label>
                         <input type="url" id="server-api-url" required>
                     </div>
                     <div class="form-group">
                         <label for="server-model-root-path">Model Root Path:</label>
                         <div class="input-with-button">
                            <input type="text" id="server-model-root-path" placeholder="Path to models directory">
                            <button type="button" id="browse-model-path-btn" class="secondary-button">Browse...</button>
                         </div>
                         <small>Base directory where your model folders (Stable-diffusion, Lora, etc.) are located.</small>
                     </div>
                     <div class="form-group">
                         <label>Authentication (Basic Auth):</label>
                         <div>
                            <label for="server-auth-user">Username:</label>
                            <input type="text" id="server-auth-user">
                         </div>
                          <div>
                            <label for="server-auth-pass">Password:</label>
                            <input type="password" id="server-auth-pass">
                         </div>
                         <small>Leave blank for no authentication.</small>
                     </div>
                     <button type="submit" id="save-server-btn" class="primary-button">Save Server</button>
                     <button type="button" id="cancel-edit-btn" style="display: none;">Cancel Edit</button>
                 </form>
             </div>
        </section>

    </main>

    <footer>
        <p>MobileSD Interface</p>
    </footer>

    <script src="js/app.js"></script>
</body>
</html>
